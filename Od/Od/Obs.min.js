var Obs;(function(n){var a=!1,o,u,l,r;n.defaultEq=function(n,t){return n===t};n.valueOfEq=function(n,t){return n&&t&&n.valueOf()===t.valueOf()||!n&&!t};n.alwaysUpdate=function(){return!1};n.of=function(t,i){i===void 0&&(i=null);i=i?i:o(t)?n.defaultEq:n.alwaysUpdate;var r=undefined;return r=function(n){return s(r,i,n,arguments.length)},r.id=e++,r.value=t,r.toString=u,r};o=function(n){var t=typeof n;return t==="number"||t==="string"||t==="boolean"};n.fn=function(t,i){i===void 0&&(i=n.defaultEq);var r=undefined;return r=function(n){return s(r,i,n,arguments.length)},r.id=e++,r.fn=function(){return v(r,t,i)},r.dependencies={},r.toString=u,h(r),r};n.peek=function(n){return n.value};n.isObservable=function(n){return!!n.id};n.isComputed=function(n){return!!n.fn};n.subscribe=function(n,t){for(var f,h=function(){var n=i;i=undefined;t();i=n},r=h,c=e++,o=n,s=0;s<o.length;s++)f=o[s],f.dependents||(f.dependents={}),f.dependents[c]=r;return r.id=c,r.fn=h,r.value="{subscription}",r.toString=u,r.subscriptions=o,r.level=999999999,r};n.toStringMaxValueLength=32;u=function(){var t=JSON.stringify(this.value);return t&&n.toStringMaxValueLength<t.length&&(t=t.substr(0,n.toStringMaxValueLength)+"..."),"{obs "+this.id+" = "+t+"}"};n.dispose=function(n){var t=n,f,i,r,e,u;if(t.value=undefined,c(t),t.dependents=undefined,f=t.id,i=t.subscriptions,i){for(r=0;r<i.length;r++)(e=i[r],u=e.dependents,u)&&(u[f]=undefined);t.subscriptions=undefined}};var s=function(t,u,f,e){if(e){if(t.fn)throw new Error("Computed observables cannot be assigned to.");r("Updating obs",t.id);var o=t.value;t.value=f;u(o,f)||n.updateDependents(t)}else i&&(i[t.id]=t);return t.value},v=function(n,t,i){var u=n.value,r=t();return n.value=r,!i(u,r)},e=1,t=[],y=function(n){var i,u,e,f,o;if(!n.isInUpdateQueue){for(r("  Enqueueing obs",n.id),i=t.length,t.push(n),n.isInUpdateQueue=!0,u=i>>1,e=n.level;i;){if(f=t[u],o=f.level,o<=e)break;t[i]=f;i=u;u=i>>1}t[i]=n;r("    UpdateQ =",JSON.stringify(t.map(function(n){return n.id})))}},p=function(){var u,n,i;if(!t.length)return undefined;u=t[0];u.isInUpdateQueue=!1;r("  Dequeueing obs",u.id);var e=t.pop(),o=e.level,f=t.length;if(!f)return u;for(n=0,i=1;i<f;){var s=Math.min(i+1,f-1),h=t[i],c=t[s],l=h.level,a=c.level;if(l<=a){if(o<=l)break;t[n]=h;n=i}else{if(o<=a)break;t[n]=c;n=s}i=n<<1}return t[n]=e,u},f=0;n.startUpdate=function(){f++};n.endUpdate=function(){f&&f--;f===0&&w()};var w=function(){for(;;){var n=p();if(!n)return;h(n)}},i=undefined,h=function(t){var u,f;r("Reevaluating obs",t.id,"...");u=i;i=t.dependencies;c(t);f=l(t);b(t);i=u;f&&n.updateDependents(t);r("Reevaluating obs",t.id,"done.")},c=function(n){var u=n.id,t=n.dependencies,i,r;if(t)for(i in t)(r=t[i],r)&&(t[i]=undefined,r.dependents[u]=undefined)},b=function(n){var f=n.id,e=n.dependencies,i=0,o,t,u;for(o in e)(t=e[o],t)&&(t.dependents||(t.dependents={}),t.dependents[f]=n,r("  Obs",f,"depends on obs",t.id),u=t.level|0,i<=u&&(i=1+u));n.level=i};n.updateDependents=function(t){var i=t.dependents,u,r;if(i){n.startUpdate();for(u in i)(r=i[u],r)&&y(r);n.endUpdate()}};n.exceptionReporter=function(n){return window.console&&window.console.log?window.console.log(n):alert("Exception reevaluating computed observable:\n"+JSON.stringify(n))};l=function(t){try{return t.fn()}catch(i){return n.exceptionReporter(i),!1}};r=function(){a&&window.console&&window.console.log&&console.log.apply(console,arguments)}})(Obs||(Obs={}));