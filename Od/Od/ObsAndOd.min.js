var Obs,Od;(function(n){var r=!0,o;n.of=function(n,t){t===void 0&&(t=h);var i=undefined;return i=function(n){return c(i,t,n,arguments.length)},i.id=e++,i.value=n,i.toString=f,i.dispose=s,i};n.fn=function(n,t){t===void 0&&(t=h);var i=undefined;return i=function(n){return c(i,t,n,arguments.length)},i.id=e++,i.fn=function(){return p(i,n,t)},i.dependencies={},i.toString=f,i.dispose=s,l(i),i};n.peek=function(n){return n.value};n.isObservable=function(n){return!!n.id};n.isComputed=function(n){return!!n.fn};n.subscribe=function(n,t){for(var u,h=function(){var n=i;i=undefined;t();i=n},r=h,c=e++,o=n,s=0;s<o.length;s++)u=o[s],u.dependents||(u.dependents={}),u.dependents[c]=r;return r.id=c,r.level=999999999,r.fn=h,r.value="{subscription}",r.toString=f,r.dispose=function(){y(r,o)},r};n.toStringMaxValueLength=32;var f=function(){var t=JSON.stringify(this.value);return t&&n.toStringMaxValueLength<t.length&&(t=t.substr(0,n.toStringMaxValueLength)+"..."),"{obs "+this.id+" = "+t+"}"},s=function(){var n=this;n.value=undefined;a(n);n.dependents=undefined},y=function(n,t){for(var r=n.id,i=0;i<t.length;i++)t[i].dependents[r]=undefined},h=function(n,t){return n===t},c=function(n,t,u,f){if(f){if(n.fn)throw new Error("Computed observables cannot be assigned to.");r&&console.log("Updating obs "+n.id);var e=n.value;n.value=u;t(e,u)||v(n)}return i&&(i[n.id]=n),n.value},p=function(n,t,i){var u=n.value,r=t();return n.value=r,!i(u,r)},e=1,t=[],w=function(n){var i,u,e,f,o;if(!n.isInUpdateQueue){for(r&&console.log("  Enqueueing obs "+n.id),i=t.length,t.push(n),n.isInUpdateQueue=!0,u=i>>1,e=n.level;i;){if(f=t[u],o=f.level,o<=e)break;t[i]=f;i=u;u=i>>1}t[i]=n;r&&console.log("    UpdateQ = "+JSON.stringify(t.map(function(n){return n.id})))}},b=function(){var u,n,i;if(!t.length)return undefined;u=t[0];u.isInUpdateQueue=!1;r&&console.log("  Dequeueing obs "+u.id);var e=t.pop(),o=e.level,f=t.length;if(!f)return u;for(n=0,i=1;i<f;){var s=Math.min(i+1,f-1),h=t[i],c=t[s],l=h.level,a=c.level;if(l<=a){if(o<=l)break;t[n]=h;n=i}else{if(o<=a)break;t[n]=c;n=s}i=n<<1}return t[n]=e,u},u=0;n.startUpdate=function(){u++};n.endUpdate=function(){u&&u--;u===0&&k()};var k=function(){for(;;){var n=b();if(!n)return;l(n)}},i=undefined,l=function(n){var t,u;r&&console.log("Reevaluating obs "+n.id+"...");t=i;i=n.dependencies;a(n);u=o(n);d(n);i=t;u&&v(n);r&&console.log("Reevaluating obs "+n.id+" done.")},a=function(n){var u=n.id,t=n.dependencies,i,r;if(t)for(i in t)(r=t[i],r)&&(t[i]=undefined,r.dependents[u]=undefined)},d=function(n){var f=n.id,e=n.dependencies,i=0,o,t,u;for(o in e)(t=e[o],t)&&(t.dependents||(t.dependents={}),t.dependents[f]=n,r&&console.log("  Obs "+f+" depends on obs "+t.id),u=t.level|0,i<=u&&(i=1+u));n.level=i},v=function(t){var i=t.dependents,u,r;if(i){n.startUpdate();for(u in i)(r=i[u],r)&&w(r);n.endUpdate()}};n.exceptionReporter=function(n){return window.console&&window.console.log?window.console.log(n):alert("Exception reevaluating computed observable:\n"+JSON.stringify(n))};o=function(t){try{return t.fn()}catch(i){return n.exceptionReporter(i),!1}}})(Obs||(Obs={})),function(n){function o(){var t=this,u=t.obs(),i=t.dom,f=i&&i.parentNode,r;e(i,null);r=n.patchDom(u,i,f);e(r,t);t.dom=r}var t=!0,r,i;n.text=function(n){return{text:h(n)?"":n.toString()}};n.element=function(n,t,i){n=n.toUpperCase();var r=l(t),u=i?s(i)?i:[i]:null;return{tag:n,props:r,children:u}};n.component=function(n){var i=Obs.isObservable(n)?n:Obs.fn(n),t={obs:i,subs:null,dom:null},r=Obs.subscribe([i],o.bind(t));return t.subs=r,r(),t};var s=function(n){return n instanceof Array},h=function(n){return n===null||n===undefined},c=[],l=function(n){var t,i;if(!n)return null;var r=[],u=Object.keys(n).sort(),f=u.length;for(t=0;t<f;t++)i=u[t],r.push(i,n[i]);return r};n.patchDom=function(t,i,r){var u=typeof t=="string"?n.text(t):t;return u.tag?y(u,i,r):u.obs?v(u,i,r):a(u,i,r)};var a=function(n,t,r){var f=n.text,u=!t||t.nodeName!=="#text"?document.createTextNode(f):t;return u.textContent!==f&&(u.textContent=f),i(u,t,r),u},v=function(n,t,r){var u=n.dom;return u!==t&&i(u,t,r),u},y=function(n,r,u){var o=n.tag,s=n.props,h=n.children,f=r,e=!f||f.tagName!==o||p(f)?document.createElement(o):f;return t&&e!==f&&console.log("Created",o),d(e,s),nt(e,h),i(e,r,u),e},p=function(n){return!!tt(n)},w=[],b=function(n){return n.__Od__props},k=function(n,t){n.__Od__props=t},d=function(n,t){var e=b(n),o,s,h;if(t||e){e||(e=w);t||(t=c);for(var r=0,i=0,a=e.length,v=t.length,l=[];r<a&&i<v;)o=e[r],s=t[i],o<s?(u(n,o),r+=1):(h=t[i+1],f(n,s,h,l),i+=2,r+=o===s?1:0);while(r<a)o=e[r],u(n,o),r+=1;while(i<v)s=t[i],h=t[i+1],f(n,s,h,l),i+=2;k(n,l)}},u=function(n,t){n[t]=undefined;n instanceof HTMLElement&&n.removeAttribute(t)},f=function(n,t,i,r){n[t]=i;r.push(t)},g=[],nt=function(r,u){var o=r.childNodes,h,s,f,c,e;for(u||(u=g),h=o.length,s=u.length,f=h-1;s<=f;f--)e=o[f],i(null,e,r),t&&console.log("Removed child",f+1);for(f=0;f<s;f++)t&&console.log("Patching child",f+1),c=u[f],e=o[f],n.patchDom(c,e,r),t&&console.log("Patched child",f+1)},tt=function(n){return n.__Od__component},e=function(n,t){n&&(n.__Od__component=t)};r=[];i=function(n,i,u){if(n)if(i){if(n===i)return;if(t&&console.log("Deleted",i.nodeName||"#text"),r.push(i),!u)return;t&&console.log("Inserted",n.nodeName||"#text");u&&u.replaceChild(n,i)}else t&&console.log("Inserted",n.nodeName||"#text"),u&&u.appendChild(n);else{if(!i)return;t&&console.log("Deleted",i.nodeName||"#text");r.push(i);u&&u.removeChild(i)}}}(Od||(Od={}));