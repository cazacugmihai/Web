var Od,Obs;(function(n){function lt(){var t=this,r=t.dom,f,e,u;if(r){yt(t);return}f=t.obs();e=r&&r.parentNode;i(r,null);u=n.patchDom(f,r,e);i(u,t);t.dom=u}var w=!0;n.text=function(n){return{text:r(n)?"":n.toString()}};n.element=function(n,t,i){n=n.toUpperCase();var r=d(t),u=i?b(i)?i:[i]:null;return{tag:n,props:r,children:u}};n.component=function(n){var i=Obs.isObservable(n)?n:Obs.fn(n),t={obs:i,subs:null,dom:null},r=Obs.subscribe([i],lt.bind(t));return t.subs=r,r(),t};n.bind=function(t,i){var r=i.parentNode;n.patchDom(t,i,r)};n.appendChild=function(t,i){n.patchDom(t,null,i)};n.deferComponentUpdates=!0;var b=function(n){return n instanceof Array},r=function(n){return n===null||n===undefined},k=[],d=function(n){var t,i;if(!n)return null;var r=[],u=Object.keys(n).sort(),f=u.length;for(t=0;t<f;t++)i=u[t],r.push(i,n[i]);return r};n.patchDom=function(t,i,r){var u=typeof t=="string"?n.text(t):t;return u.tag?tt(u,i,r):u.obs?nt(u,i,r):g(u,i,r)};var g=function(n,t,i){var u=n.text,r=!t||t.nodeName!=="#text"?document.createTextNode(u):t;return r.textContent!==u&&(r.textContent=u),f(r,t,i),r},nt=function(n,t,i){var r=n.dom;return r!==t&&f(r,t,i),r},tt=function(n,i,r){var s=n.tag,h=n.props,c=n.children,u=i,o=!u||u.tagName!==s||e(u)?document.createElement(s):u;return o!==u&&t("  Created",s),ut(o,h),et(o,c),f(o,i,r),o},it=[],c=function(n){return n.__Od__props},rt=function(n,t){n.__Od__props=t},ut=function(n,t){var u=c(n),f,e,o;if(t||u){u||(u=it);t||(t=k);for(var r=0,i=0,h=u.length,v=t.length,s=[];r<h&&i<v;)f=u[r],e=t[i],f<e?(l(n,f),r+=1):(o=t[i+1],a(n,e,o,s),i+=2,r+=f===e?1:0);while(r<h)f=u[r],l(n,f),r+=1;while(i<v)e=t[i],o=t[i+1],a(n,e,o,s),i+=2;rt(n,s)}},l=function(n,t){n[t]=undefined;n instanceof HTMLElement&&n.removeAttribute(t)},a=function(n,t,i,r){n[t]=i;r.push(t)},ft=[],et=function(i,r){var u,h,e;r||(r=ft);i.keyed&&ot(r,i);var o=i.childNodes,c=o.length,s=r.length;for(u=c-1;s<=u;u--)e=o[u],f(null,e,i),t("Removed child",u+1);for(u=0;u<s;u++)t("Patching child",u+1),h=r[u],e=o[u],n.patchDom(h,e,i),t("Patched child",u+1)},ot=function(n,t){var l=n,y=t.firstChild,a=l.length,h,c,i,o,f,u,s,v,e;if(a!==0&&y){for(h={},i=t.firstChild;i;i=i.nextSibling){if(c=i.key,r(c))return;h[c]=i}for(i=t.firstChild,o=0;o<a;o++){if(f=l[o],u=f.tag,r(u)&&f.dom&&(u=f.dom.nodeName),!u)return;if(s=ht(f.props),r(s))return;v=i&&i.key;e=h[s];i?v===s?i=i.nextSibling:e?t.insertBefore(e,i):t.insertBefore(document.createElement(u),i):e?t.appendChild(e):t.appendChild(document.createElement(u))}}},st=function(n,t){var r,i;if(!n)return null;for(r=n.length,i=0;i<r;i+=2)if(n[i]===t)return n[i+1];return null},ht=function(n){return st(n,"key")},ct=function(n){return n.__Od__component},i=function(n,t){n&&(n.__Od__component=t)},e=function(n){return!!ct(n)};var at=function(n){return setTimeout(n,16)},vt=window.requestAnimationFrame||at,u=[],o=0,yt=function(t){if(!n.deferComponentUpdates){v(t);return}(u.push(t),o)||(o=vt(pt))},pt=function(){for(var r,n,f={},e=u.length,i=0;i<e;i++)(r=u[i],n=r.obs.id,f[n])||(t("Patching queued component #",n),v(r),f[n]=!0);u=[];o=0},v=function(t){var f=t.obs(),r=t.dom,e=r&&r.parentNode,u;wt(f,r)?(i(r,null),h(r)):i(r,null);u=n.patchDom(f,r,e);i(u,t);t.dom=u},wt=function(n,t){return t?typeof n=="string"?t.nodeType!==Node.TEXT_NODE:t.nodeName!==n.tag:!1},s=[],h=function(n){n&&(e(n)||(t("  Discarded",n.nodeName||"#text"),s.push(n),y)||(y=setTimeout(bt,100)))},y=0,bt=function(){for(var n=s.pop();n;)p(n),n=s.pop()},p=function(n){var i,u,r,f,t;if(!e(n)){for(i=c(n)||[],u=i.length,t=0;t<u;t++)n[i[t]]=undefined;for(r=n.childNodes,f=r.length,t=0;t<f;t++)p(r[t])}},f=function(n,i,r){if(n)if(i){if(n===i)return;if(h(i),!r)return;t("  Inserted",n.nodeName||"#text");r&&r.replaceChild(n,i)}else t("  Inserted",n.nodeName||"#text"),r&&r.appendChild(n);else{if(!i)return;h(i);r&&r.removeChild(i)}},t=function(){w&&window.console&&window.console.log&&console.log.apply(console,arguments)}})(Od||(Od={})),function(n){var v=!0,a,r;n.defaultEq=function(n,t){return n===t};n.alwaysUpdate=function(){return!1};n.of=function(t,i){i===void 0&&(i=n.defaultEq);var r=undefined;return r=function(n){return s(r,i,n,arguments.length)},r.id=e++,r.value=t,r.toString=f,r.dispose=o,r};n.fn=function(t,i){i===void 0&&(i=n.defaultEq);var r=undefined;return r=function(n){return s(r,i,n,arguments.length)},r.id=e++,r.fn=function(){return p(r,t,i)},r.dependencies={},r.toString=f,r.dispose=o,h(r),r};n.peek=function(n){return n.value};n.isObservable=function(n){return!!n.id};n.isComputed=function(n){return!!n.fn};n.subscribe=function(n,t){for(var u,h=function(){var n=i;i=undefined;t();i=n},r=h,c=e++,o=n,s=0;s<o.length;s++)u=o[s],u.dependents||(u.dependents={}),u.dependents[c]=r;return r.id=c,r.level=999999999,r.fn=h,r.value="{subscription}",r.toString=f,r.dispose=function(){y(r,o)},r};n.toStringMaxValueLength=32;var f=function(){var t=JSON.stringify(this.value);return t&&n.toStringMaxValueLength<t.length&&(t=t.substr(0,n.toStringMaxValueLength)+"..."),"{obs "+this.id+" = "+t+"}"},o=function(){var n=this;n.value=undefined;c(n);n.dependents=undefined},y=function(n,t){for(var r=n.id,i=0;i<t.length;i++)t[i].dependents[r]=undefined},s=function(n,t,u,f){if(f){if(n.fn)throw new Error("Computed observables cannot be assigned to.");r("Updating obs",n.id);var e=n.value;n.value=u;t(e,u)||l(n)}return i&&(i[n.id]=n),n.value},p=function(n,t,i){var u=n.value,r=t();return n.value=r,!i(u,r)},e=1,t=[],w=function(n){var i,u,e,f,o;if(!n.isInUpdateQueue){for(r("  Enqueueing obs",n.id),i=t.length,t.push(n),n.isInUpdateQueue=!0,u=i>>1,e=n.level;i;){if(f=t[u],o=f.level,o<=e)break;t[i]=f;i=u;u=i>>1}t[i]=n;r("    UpdateQ =",JSON.stringify(t.map(function(n){return n.id})))}},b=function(){var u,n,i;if(!t.length)return undefined;u=t[0];u.isInUpdateQueue=!1;r("  Dequeueing obs",u.id);var e=t.pop(),o=e.level,f=t.length;if(!f)return u;for(n=0,i=1;i<f;){var s=Math.min(i+1,f-1),h=t[i],c=t[s],l=h.level,a=c.level;if(l<=a){if(o<=l)break;t[n]=h;n=i}else{if(o<=a)break;t[n]=c;n=s}i=n<<1}return t[n]=e,u},u=0;n.startUpdate=function(){u++};n.endUpdate=function(){u&&u--;u===0&&k()};var k=function(){for(;;){var n=b();if(!n)return;h(n)}},i=undefined,h=function(n){var t,u;r("Reevaluating obs",n.id,"...");t=i;i=n.dependencies;c(n);u=a(n);d(n);i=t;u&&l(n);r("Reevaluating obs",n.id,"done.")},c=function(n){var u=n.id,t=n.dependencies,i,r;if(t)for(i in t)(r=t[i],r)&&(t[i]=undefined,r.dependents[u]=undefined)},d=function(n){var f=n.id,e=n.dependencies,i=0,o,t,u;for(o in e)(t=e[o],t)&&(t.dependents||(t.dependents={}),t.dependents[f]=n,r("  Obs",f,"depends on obs",t.id),u=t.level|0,i<=u&&(i=1+u));n.level=i},l=function(t){var i=t.dependents,u,r;if(i){n.startUpdate();for(u in i)(r=i[u],r)&&w(r);n.endUpdate()}};n.exceptionReporter=function(n){return window.console&&window.console.log?window.console.log(n):alert("Exception reevaluating computed observable:\n"+JSON.stringify(n))};a=function(t){try{return t.fn()}catch(i){return n.exceptionReporter(i),!1}};r=function(){v&&window.console&&window.console.log&&console.log.apply(console,arguments)}}(Obs||(Obs={}));